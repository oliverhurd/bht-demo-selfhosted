<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDF Viewer — Braveheart Trading</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<style>
  :root {
    --gold: #C9A84C;
    --gold-light: #E2C47A;
    --black: #0A0A0A;
    --black-2: #111111;
    --black-3: #181818;
    --border: rgba(201,168,76,0.15);
    --border-subtle: rgba(255,255,255,0.06);
    --text: #F0EDE6;
    --text-muted: #7A7468;
    --text-dim: #3A3530;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  
  body {
    background: var(--black);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    display: grid;
    grid-template-rows: 56px 1fr;
    min-height: 100vh;
  }

  header {
    background: rgba(10,10,10,0.95);
    border-bottom: 1px solid var(--border-subtle);
    backdrop-filter: blur(20px);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 32px;
  }

  .header-left {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .logo-mark {
    width: 32px;
    height: 32px;
    border: 1.5px solid var(--gold);
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Playfair Display', serif;
    font-size: 13px;
    font-weight: 700;
    color: var(--gold);
    position: relative;
  }

  .logo-mark::before {
    content: '';
    position: absolute;
    inset: 3px;
    border: 1px solid rgba(201,168,76,0.25);
  }

  .header-title {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text-muted);
  }

  .header-actions {
    display: flex;
    gap: 12px;
  }

  .btn {
    font-family: 'DM Mono', monospace;
    font-size: 9px;
    letter-spacing: 2px;
    text-transform: uppercase;
    background: var(--gold);
    color: var(--black);
    border: none;
    padding: 8px 18px;
    cursor: pointer;
    transition: background 0.2s;
    text-decoration: none;
    font-weight: 500;
  }

  .btn:hover {
    background: var(--gold-light);
  }

  .btn-secondary {
    background: transparent;
    color: var(--text-muted);
    border: 1px solid var(--border-subtle);
  }

  .btn-secondary:hover {
    border-color: var(--gold);
    color: var(--gold);
    background: transparent;
  }

  .pdf-container {
    padding: 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 24px;
    overflow-y: auto;
  }

  .pdf-info {
    text-align: center;
    margin-bottom: 24px;
  }

  .pdf-name {
    font-family: 'Playfair Display', serif;
    font-size: 24px;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 8px;
  }

  .pdf-meta {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    color: var(--text-dim);
    letter-spacing: 1px;
  }

  #pdf-canvas {
    max-width: 100%;
    height: auto;
    border: 1px solid var(--border-subtle);
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
  }

  .pdf-controls {
    display: flex;
    align-items: center;
    gap: 20px;
    background: var(--black-2);
    border: 1px solid var(--border-subtle);
    padding: 16px 24px;
  }

  .page-info {
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    color: var(--text-muted);
  }

  .nav-btn {
    background: var(--black-3);
    border: 1px solid var(--border-subtle);
    color: var(--text-muted);
    padding: 8px 16px;
    font-family: 'DM Mono', monospace;
    font-size: 9px;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
  }

  .nav-btn:hover {
    border-color: var(--gold);
    color: var(--gold);
  }

  .nav-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .loading {
    text-align: center;
    padding: 100px 20px;
    font-family: 'DM Mono', monospace;
    font-size: 12px;
    color: var(--text-dim);
  }
</style>
</head>
<body>

<header>
  <div class="header-left">
    <div class="logo-mark">BHT</div>
    <span class="header-title">PDF Viewer</span>
  </div>
  <div class="header-actions">
    <button class="btn" onclick="downloadPDF()">⬇ Download PDF</button>
    <a href="members.html" class="btn-secondary btn">← Back to Course</a>
  </div>
</header>

<div class="pdf-container">
  
  <div class="pdf-info">
    <h1 class="pdf-name">Inception Model — Narrative Framework</h1>
    <p class="pdf-meta">Module 1 Reference · Braveheart Trading</p>
  </div>

  <div class="loading" id="loading">Loading PDF...</div>

  <canvas id="pdf-canvas" style="display:none;"></canvas>

  <div class="pdf-controls" id="controls" style="display:none;">
    <button class="nav-btn" id="prev-btn" onclick="prevPage()">← Prev</button>
    <span class="page-info">Page <span id="page-num">1</span> of <span id="page-count">--</span></span>
    <button class="nav-btn" id="next-btn" onclick="nextPage()">Next →</button>
  </div>

</div>

<script>
  // Initialize Supabase
  const SUPABASE_URL = 'https://ueeecuvnqyqsxjafbyzy.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlZWVjdXZucXlxc3hqYWZieXp5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzNTMyMTcsImV4cCI6MjA4NjkyOTIxN30.2EuYujAMsDSZcndLNhz_lzakCqdxezXhfod6p6RWNUw';
  
  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // Check auth
  supabase.auth.getSession().then(({ data: { session } }) => {
    if (!session) {
      window.location.href = 'login.html';
    } else {
      loadPDF();
    }
  });

  // PDF.js setup
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

  let pdfDoc = null;
  let pageNum = 1;
  let pageRendering = false;
  let pageNumPending = null;
  const canvas = document.getElementById('pdf-canvas');
  const ctx = canvas.getContext('2d');

  // For this demo, we'll create a sample PDF URL
  // In production, replace this with your actual PDF URL from cloud storage
  const PDF_URL = 'https://mozilla.github.io/pdf.js/web/compressed.tracemonkey-pldi-09.pdf';

  function loadPDF() {
    pdfjsLib.getDocument(PDF_URL).promise.then(pdf => {
      pdfDoc = pdf;
      document.getElementById('page-count').textContent = pdf.numPages;
      document.getElementById('loading').style.display = 'none';
      document.getElementById('pdf-canvas').style.display = 'block';
      document.getElementById('controls').style.display = 'flex';
      renderPage(pageNum);
    }).catch(err => {
      document.getElementById('loading').textContent = 'Error loading PDF. Please try again.';
      console.error('PDF load error:', err);
    });
  }

  function renderPage(num) {
    pageRendering = true;
    pdfDoc.getPage(num).then(page => {
      const viewport = page.getViewport({ scale: 1.5 });
      canvas.height = viewport.height;
      canvas.width = viewport.width;

      const renderContext = {
        canvasContext: ctx,
        viewport: viewport
      };

      page.render(renderContext).promise.then(() => {
        pageRendering = false;
        if (pageNumPending !== null) {
          renderPage(pageNumPending);
          pageNumPending = null;
        }
      });
    });

    document.getElementById('page-num').textContent = num;
    updateButtons();
  }

  function queueRenderPage(num) {
    if (pageRendering) {
      pageNumPending = num;
    } else {
      renderPage(num);
    }
  }

  function prevPage() {
    if (pageNum <= 1) return;
    pageNum--;
    queueRenderPage(pageNum);
  }

  function nextPage() {
    if (pageNum >= pdfDoc.numPages) return;
    pageNum++;
    queueRenderPage(pageNum);
  }

  function updateButtons() {
    document.getElementById('prev-btn').disabled = pageNum <= 1;
    document.getElementById('next-btn').disabled = pageNum >= pdfDoc.numPages;
  }

  function downloadPDF() {
    const link = document.createElement('a');
    link.href = PDF_URL;
    link.download = 'Inception-Model-Narrative-Framework.pdf';
    link.click();
  }
</script>

</body>
</html>
